{% extends "main.html" %}
{% block title %}{{ project.title }}{% endblock %}

{% import "partials/_macros_blocks.html" as details %}


{% block content %}
<div class="inner-container" id="project-details">
{% if project %}
  <div class="big_title_block">
    <div class="profile-info">
      <div id="projectName" class="name">{{ project.title }}</div>
      <div id="projectId" class="username">{{ project.uuid }}</div>
    </div>
  </div>

  {{ details.title_h4("Детали проекта") }}

  {% call details.text_section() %}
    {{ project.description }}
  {% endcall %}

  {{ details.title_h4("Данные о проекте") }}
  <div class="detail-card">
      <div class="detail-title">Дата создания</div>
      <div class="detail-info" id="projectCreatedAt">{{ project.created_at }}</div>
  </div>
  {% else %}

  {% call details.text_section() %}
  <p style="text-align: center;">
    Кажется такого проекта не существует или возникла ошибка
  </p>
  {% endcall %}

{% endif %}
</div>

<div class="d-grid gap-2" id="backButton"></div>
{% endblock %}

{% block scripts %}
<script>
  const createdAtBlock = document.getElementById('projectCreatedAt');
  const tg = window.Telegram?.WebApp;
  const inTelegram = !!tg && tg.initData !== '';
  const backButtonDiv = document.getElementById("backButton");
  const prevUrl = document.referrer;

  const handleBack = () => {
    tg.MainButton.hide();
    if (window.history.length > 1) {
      window.history.back()
    } else {
      tg.close()
    };
  };

  if (inTelegram) {
    tg.ready();
    tg.MainButton.show();
    tg.MainButton.setText("Назад");
    tg.MainButton.isVisible = true;
    tg.MainButton.onClick(handleBack);

  } else {
    const buttonBack = document.createElement('button');
    buttonBack.innerText = "Назад";
    buttonBack.classList.add("btn", "btn-primary", "mt-4", "py-2");
    buttonBack.onclick=handleBack;
    buttonBack.type="button";

    if (prevUrl && !prevUrl.includes("/login")) {
      backButtonDiv.appendChild(buttonBack);
      backButtonDiv.classList.remove("d-none");
    }
  };
  window.loginTelegramWidget2 = handleBack;

  function formatDateHuman(dateString) {
    const date = new Date(dateString);
    return new Intl.DateTimeFormat('ru-RU', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    }).format(date);
  }
  const createdAtDate = formatDateHuman(createdAtBlock.innerText);
  createdAtBlock.innerText = createdAtDate;
</script>
{% endblock %}