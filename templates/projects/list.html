{% extends "base.html" %}
{% block title %}Мои проекты{% endblock %}

{% import "partials/_macros_blocks.html" as details %}

{% block head_extra %}
  <style>
      .text-link {
          cursor: pointer;
          transition: all 0.2s ease-in-out;
      }

      .text-link:is(:hover,:focus,:active),
      .text-section.text-link:is(:hover,:focus,:active) {
          transition: all 0.2s ease-in-out;
          background: var(--third-bg-color);
      }

      .text-link:is(:hover,:focus,:active) * {
          transition: all 0.2s ease-in-out;
          color: var(--accent-text-color) !important;
      }
  </style>
{% endblock %}

{% block content %}
  {% if projects %}

    <span class="overflow-x-hidden w-100 h-100">
      <div class="glow-layer z-n1" style="--top: 10%; --left: 14%;">
        <div class="wrapper">
          <div class="element"></div>
          <div class="element"></div>
          <div class="element"></div>
          <div class="element"></div>
        </div>
      </div>
    </span>

    <section class="mb-1 mb-sm-3">
      <div class="container pt-4 pb-2 px-0">
        <div class="row w-100 mx-auto">
          <div class="col-12 col-lg-3 align-self-center text-center">
            <img
                src="/static/media/nonePhoto.png"
                id="userAvatar"
                class="avatar rounded-pill"
                alt="Аватар"
                width="200"
                height="200"
                onerror="this.src='/static/media/nonePhoto.png'"
                style="width: min(200px, 100%); height: auto; pointer-events: none;"
            />
          </div>
          <div class="col-12 col-lg-9 text-center text-lg-start align-self-center  pt-4 py-lg-3 ">
            <h1 id="projectName" class="header header-anim header-accent xxl "
                style=" overflow-wrap: anywhere;">
              {{ user.first_name }} <span class="header header-anim color-white">{{ user.last_name }}</span></h1>

          </div>
        </div>
      </div>
    </section>

    <section class="my-0 my-md-2">
      <div class="container">
        <h4 class="header mt-4 ps-3">Твои проекты</h4>
        <div class="list-section">
          {% for project in projects %}
            <a href="{{ url_for('user-projects:detail', project_uuid=project.uuid) }}" style="text-decoration: none;"
               class="item w-100 p-3 border rounded-3 my-1">
              <div class="d-flex gap-2 w-100 justify-content-between">
                <div>
                  <p class="mb-0">{{ project.title }}</p>
                  <p class="mb-0 opacity-75 small">{{ project.description }}</p>
                </div>
                <small class="opacity-50 text-nowrap"></small>
              </div>
              <i class="bi bi-caret-right-fill align-self-center"></i>
            </a>
          {% endfor %}
        </div>
      </div>
    </section>

    <section class="my-3 mb-5 pb-3">
      <div class="container">
        <div class="list-group list-section">
          <a href="/profile" style="text-decoration: none;"
             class="item list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <span>
              <img src="/static/media/nonePhoto.png" alt="" onerror="this.src='/static/media/nonePhoto.png'" width="32"
                   height="32"
                   class="rounded-circle me-2 flex-shrink-0">
              <span>
                Мой профиль
              </span>
            </span>
            <i class="bi bi-caret-right-fill align-self-center"></i>
          </a>
        </div>
      </div>
    </section>
  {% else %}
    <section
        class="
        full-screen
        d-flex
        justify-content-center
        align-items-center
        w-100
        h-100
        position-relative
        overflow-x-hidden"
    >
      <div class="gradient gradient-warning" style="--top: 50%">
        <div class="wrapper" style="--size: 500px">
          <div class="element"></div>
          <div class="element"></div>
          <div class="element"></div>
          <div class="element"></div>
        </div>
      </div>
      <div class="form-signin w-100 m-auto">
        <h1 class="mb-3 header" id="statusAuth" style="font-size: clamp(2rem, 9vw, 4.5rem)">
          <span class="word">
        Кажется, что у тебя пока нет
      </span>
          <span class="word color-warning">проектов</span>
        </h1>
        <h4 class="header" id="statusAuth">
          <span class="word">
        Скоро появится возможность их создавать
      </span>
        </h4>
        <div class="my-5"></div>
        <div class="list-group list-section">
          <a href="/profile" style="text-decoration: none;"
             class="item list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            <span>
              <img src="/static/media/nonePhoto.png"
                   alt=""
                   onerror="this.src='/static/media/nonePhoto.png'"
                   width="32"
                   height="32"
                   class="rounded-circle me-2 flex-shrink-0"
              >
              <span>
                Мой профиль
              </span>
            </span>
            <i class="bi bi-caret-right-fill align-self-center"></i>
          </a>
        </div>
      </div>
    </section>
  {% endif %}

{% endblock %}

{% block scripts %}
  <script defer>
    const tg = window.Telegram?.WebApp;
    const inTelegram = !!tg && tg.initData !== '';
    tg.ready();
    tg.expand();
  </script>

  <script>
    function updateGlowPosition() {
      const avatar = document.getElementById("userAvatar");
      const glow = document.querySelector(".glow-layer");

      if (!avatar || !glow) return;

      const rect = avatar.getBoundingClientRect();
      const sectionRect = avatar.closest("section").getBoundingClientRect();

      const centerX = rect.left - sectionRect.left + rect.width / 2;
      const centerY = rect.top - sectionRect.top + rect.height / 2;

      glow.style.setProperty("--left", centerX + "px");
      glow.style.setProperty("--top", centerY + "px");
    }

    window.addEventListener("load", updateGlowPosition);
    window.addEventListener("resize", updateGlowPosition);
    window.addEventListener("scroll", updateGlowPosition);

  </script>
{% endblock %}
